<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phish Chat Guard - Live Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .chat-container {
            max-width: 600px;
            margin: 50px auto;
        }
        .message-input {
            margin-bottom: 20px;
        }
        .phishing-alert {
            border-left: 4px solid #dc3545;
            animation: pulse 1s;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        .detection-info {
            font-size: 0.9em;
            margin-top: 10px;
        }
        .stats-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <h1 class="text-center mb-4">üõ°Ô∏è Phish Chat Guard Live Demo</h1>
            
            <!-- Stats Panel -->
            <div class="stats-panel">
                <h5>üìä Phish Chat Guard Analytics</h5>
                <div id="stats">Loading protection statistics...</div>
            </div>
            
            <!-- Message Input -->
            <div class="message-input">
                <div class="input-group">
                    <input type="text" id="messageInput" class="form-control" 
                           placeholder="Type a message to test Phish Chat Guard protection...">
                    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                </div>
            </div>
            
            <!-- Detection Result -->
            <div id="detectionResult" class="mb-3"></div>
            
            <!-- Example Messages -->
            <div class="card">
                <div class="card-header">
                    <h6>üìù Try these examples:</h6>
                </div>
                <div class="card-body">
                    <button class="btn btn-outline-danger btn-sm mb-2" 
                            onclick="testMessage('URGENT! Your bank account will be suspended. Click here: http://192.168.1.1/login')">
                        üö® High Risk Phishing
                    </button>
                    <button class="btn btn-outline-warning btn-sm mb-2" 
                            onclick="testMessage('Please login to verify your account password')">
                        ‚ö†Ô∏è Medium Risk
                    </button>
                    <button class="btn btn-outline-success btn-sm mb-2" 
                            onclick="testMessage('Hi! How are you doing today?')">
                        ‚úÖ Clean Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        // Load statistics on page load
        document.addEventListener('DOMContentLoaded', loadStats);

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const stats = await response.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="row">
                        <div class="col-md-3">
                            <strong>${stats.total_messages}</strong><br>
                            <small>Total Messages</small>
                        </div>
                        <div class="col-md-3">
                            <strong>${stats.total_phishing}</strong><br>
                            <small>Phishing Detected</small>
                        </div>
                        <div class="col-md-3">
                            <strong>${stats.total_clean}</strong><br>
                            <small>Clean Messages</small>
                        </div>
                        <div class="col-md-3">
                            <strong>${stats.phishing_percentage}%</strong><br>
                            <small>Phishing Rate</small>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('stats').innerHTML = 
                    '<span class="text-danger">Unable to load statistics. Make sure Phish Chat Guard API is running.</span>';
            }
        }

        function testMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) {
                alert('Please enter a message');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/detect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        user: 'demo_user'
                    })
                });

                const result = await response.json();
                displayResult(message, result);
                
                // Refresh stats after detection
                setTimeout(loadStats, 500);
                
                // Clear input
                messageInput.value = '';
                
            } catch (error) {
                document.getElementById('detectionResult').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> Unable to analyze message. Make sure the API is running on ${API_BASE}
                    </div>
                `;
            }
        }

        function displayResult(message, result) {
            const resultDiv = document.getElementById('detectionResult');
            
            let alertClass = result.label === 'phishing' ? 'alert-danger phishing-alert' : 'alert-success';
            let icon = result.label === 'phishing' ? '‚ö†Ô∏è' : '‚úÖ';
            let title = result.label === 'phishing' ? 'Phishing Detected!' : 'Message is Clean';
            
            let reasonsHtml = '';
            if (result.reasons && result.reasons.length > 0) {
                reasonsHtml = `
                    <div class="detection-info">
                        <strong>Reasons:</strong>
                        <ul class="mb-0 mt-1">
                            ${result.reasons.map(reason => `<li>${reason}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            resultDiv.innerHTML = `
                <div class="alert ${alertClass}">
                    <h6>${icon} ${title}</h6>
                    <div><strong>Message:</strong> "${message}"</div>
                    <div><strong>Risk Score:</strong> ${result.score} / 1.0</div>
                    ${reasonsHtml}
                </div>
            `;
        }

        // Allow Enter key to send message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>